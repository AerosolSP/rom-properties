PROJECT(libromdata-tests)

# Top-level src directory.
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../..)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR}/../..)

# Google Test
INCLUDE_DIRECTORIES(${GTEST_INCLUDE_DIR})

IF(WIN32)
	# Use extlib/zlib/.
	SET(ZLIB_LIBRARY zlibstatic)
ELSE(WIN32)
	FIND_LIBRARY(ZLIB REQUIRED)
	FIND_LIBRARY(PNG REQUIRED)

	IF(ENABLE_DECRYPTION)
		FIND_LIBRARY(Nettle REQUIRED)
	ENDIF(ENABLE_DECRYPTION)
ENDIF(WIN32)

# Copy the reference images to the test directory.
FILE(GLOB test_images *.png *.bmp.gz)
FILE(COPY ${test_images} DESTINATION "${CMAKE_CURRENT_BINARY_DIR}")

# RpImageLoader test.
ADD_EXECUTABLE(RpImageLoaderTest RpImageLoaderTest.cpp)
TARGET_LINK_LIBRARIES(RpImageLoaderTest romdata8)
TARGET_LINK_LIBRARIES(RpImageLoaderTest ${ZLIB_LIBRARY} ${GTEST_LIBRARY})
TARGET_COMPILE_DEFINITIONS(RpImageLoaderTest PRIVATE -DZLIB_CONST ${PNG_DEFINITIONS})
TARGET_INCLUDE_DIRECTORIES(RpImageLoaderTest PRIVATE ${ZLIB_INCLUDE_DIRS})
IF(PNG_LIBRARY)
	TARGET_LINK_LIBRARIES(RpImageLoaderTest ${PNG_LIBRARY})
	TARGET_INCLUDE_DIRECTORIES(RpImageLoaderTest PRIVATE ${PNG_INCLUDE_DIRS})
ENDIF(PNG_LIBRARY)
DO_SPLIT_DEBUG(RpImageLoaderTest)
SET_WINDOWS_SUBSYSTEM(RpImageLoaderTest CONSOLE)
ADD_TEST(NAME RpImageLoaderTest
	COMMAND RpImageLoaderTest
	)

# AesCipher test.
ADD_EXECUTABLE(AesCipherTest AesCipherTest.cpp)
TARGET_LINK_LIBRARIES(AesCipherTest romdata8)
TARGET_LINK_LIBRARIES(AesCipherTest ${GTEST_LIBRARY})
IF(WIN32)
	TARGET_LINK_LIBRARIES(AesCipherTest advapi32)
ENDIF(WIN32)
IF(NETTLE_LIBRARY)
	TARGET_LINK_LIBRARIES(AesCipherTest ${NETTLE_LIBRARY})
	TARGET_INCLUDE_DIRECTORIES(AesCipherTest PRIVATE ${NETTLE_INCLUDE_DIRS})
ENDIF(NETTLE_LIBRARY)
DO_SPLIT_DEBUG(AesCipherTest)
SET_WINDOWS_SUBSYSTEM(AesCipherTest CONSOLE)
ADD_TEST(NAME AesCipherTest
	COMMAND AesCipherTest
	)
